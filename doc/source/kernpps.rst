PPSAPI Interface for Precision Time Signals
===========================================

RFC-2783 describes the PPSAPI application programming interface for
external precision time signals, such as the pulse-per-second (PPS)
signal generated by some radio clocks and cesium oscillators. The PPSAPI
provides a generic capability in the ubiquitous Unix kernel which can be
used for a wide variety of measurement applications, including network
time synchronization and related experiments. The hardware to do this
requires only a serial port and a modem control lead, such as the data
carrier detect (DCD) lead, which can be driven by an external source via
a level converter/pulse generator such as described on the
:doc:`Pulse-per-second (PPS) Signal Interfacing
<pps>` page. In some systems a parallel port
can be used for the same purpose.

The PPSAPI interface defined in RFC-2783 is the only PPS interface
supported in NTP Version 4. The PPSAPI is supported in stock FreeBSD
and, with the addition of the ``PPSkit`` kernel module, in Linux.

The special header file ``/usr/include/sys/timepps.h`` implements the
PPSAPI using whatever primitives are available in each archeticture and
operating system. It obsoletes previous APIs based on the ``tty_clock``
and ``ppsclock`` line disciplines and streams modules, which are no
longer supported.

The :doc:`PPS Clock Discipline
<drivers/driver22>` driver (type 22) uses the
PPSAPI in conjunction with a local radio clock or remote NTP server as a
reference clock. The driver can also use the PPSAPI as an interface
directly to the kernel PPS facility as described on the
:doc:`Kernel Model for Precision Timekeeping
<kern>` page.

PPSAPI Application Program Interface
------------------------------------

The PPSAPI interface provides the following functions:

.. option:: time_pps_create

    Creates a PPS interface instance and returns a handle to it.

.. option:: time_pps_destroy

    Destroys a PPS interface and returns the resources used.

.. option:: time_pps_setparams

    Sets the parameters associated with a PPS interface instance,
    including offsets to be automatically added to captured timestamps.

.. option:: time_pps_getparams

    Returns the parameters associated with a PPS interface instance.

.. option:: time_pps_getcap

    Returns the capabilities of the current interface and kernel
    implementation.

.. option:: time_pps_fetch

    Returns the current timestamps associated with a PPS interface
    instance in either nanoseconds and nanoseconds (Unix ``timespec``)
    or seconds and fraction (NTP) format.

.. option:: time_pps_kcbind

    If kernel PPS processing is supported, this binds the support to the
    associated PPS interface instance.

The entire PPS interface functionality is currently provided by inline
code in the ``timepps.h`` header file. While not all implementations
support the full PPSAPI specification, they do support all the functions
required for the PPS driver described next. The FreeBSD, Linux and
Solaris implementations can be used with the stock kernels provided with
those systems; however, the Tru64 and SunOS kernels require additional
functions not provided in the stock kernels. Solaris users are cautioned
that these functions operate improperly in Solaris versions prior to 2.8
with patch Generic\_108528-02. Header files for other systems can be
found via the web at
`nanokernel.tar.gz <ftp://ftp.udel.edu/pub/ntp/software/nanokernel.tar.gz>`__.
